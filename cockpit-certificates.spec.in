Name:           cockpit-certificates
Version:        %{VERSION}
Release:        1%{?dist}
Summary:        Cockpit user interface for certificates
License:        LGPLv2+ and MIT
URL:            https://github.com/skobyda/cockpit-certificates

Source0:        https://github.com/skobyda/cockpit-certificates/releases/download/%{version}/cockpit-certificates-%{version}.tar.gz
Source1:        https://github.com/skobyda/cockpit-certificates/releases/download/%{version}/cockpit-certificates-node-%{version}.tar.xz
BuildArch:      noarch
ExclusiveArch:  %{nodejs_arches} noarch
BuildRequires:  nodejs-devel
BuildRequires:  libappstream-glib
BuildRequires:  make

Requires: cockpit-bridge
Requires: certmonger

Provides: bundled(nodejs-object-assign) = 4.1.1
Provides: bundled(nodejs-focus-trap) =  6.2.2
Provides: bundled(nodejs-scheduler) = 0.19.1
Provides: bundled(nodejs-react-dom) = 16.14.0
Provides: bundled(nodejs-react) = 16.14.0

%description
Cockpit component for managing certificates with certmonger.

%prep
%setup -q -n cockpit-certificates
%setup -q -a 1 -n cockpit-certificates
# ignore pre-built webpack in release tarball and rebuild it
rm -rf dist

%build
NODE_ENV=production make
gzip -cd dist/index.js.LICENSE.txt.gz > LICENSE

%install
%make_install
appstream-util validate-relax --nonet %{buildroot}/%{_datadir}/metainfo/*

%check
# this can't be meaningfully tested during package build; tests happen through
# FMF (see plans/all.fmf) during package gating

%files
%doc README.md
%license LICENSE
%{_datadir}/cockpit/*
%{_datadir}/metainfo/*

# The changelog is automatically generated and merged
%changelog
